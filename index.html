<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Impostor Game</title>

  <style>
    /* make the page and canvas fill the whole viewport */
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
    }

    #canvas-container {
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: black;
    }

    canvas {
      /* let canvas scale to viewport but keep aspect */
      max-width: 100%;
      max-height: 100%;
      width: 100%;
      height: 100%;
      display: block;
    }

    /* mobile text input overlay (hidden by default) */
    #mobile-text {
      position: fixed;
      left: 6px;
      right: 6px;
      bottom: 6px;
      height: 44px;
      font-size: 18px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.03);
      color: white;
      outline: none;
      display: none; /* we show it on touch devices when needed */
      z-index: 9999;
    }

    /* show the mobile input when the class is on the body */
    body.show-mobile-input #mobile-text {
      display: block;
    }

    /* small helper to keep the canvas centered on desktop if aspect differs */
    #game-aspect {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="canvas-container">
    <!-- The engine's canvas will be created/attached somewhere here.
         If your original index.html already creates a canvas with id "canvas",
         the engine will use that. If not, the engine will insert one. -->
    <div id="game-aspect"></div>
  </div>

  <!-- Hidden mobile input used only to summon the keyboard and capture typing -->
  <input id="mobile-text" type="text" inputmode="text" autocomplete="off" autocapitalize="none" autocorrect="off" />

  <!-- --- Insert Godot JS loader script lines that your export produced --- -->
  <!-- Example: (KEEP your existing script tags here: godot.js, etc.) -->
  <script src="Albanian Impostor Game AK.js"></script>
  <!-- If you have wasm br/gz files, keep those in the folder too. -->
  <!-- ------------------------------------------------------------------ -->

  <script>
    // --- Auto-resize routine for the Canvas ---
    function resizeCanvas() {
      // Find the canvas created by Godot. Many exports name it "canvas"
      const canvas = document.querySelector('canvas');
      if (!canvas) return;

      // Set CSS size to fill container (we already set this via CSS)
      canvas.style.width = '100%';
      canvas.style.height = '100%';

      // Adjust pixel ratio so the engine renders crisply.
      const deviceRatio = window.devicePixelRatio || 1;
      canvas.width = Math.floor(canvas.clientWidth * deviceRatio);
      canvas.height = Math.floor(canvas.clientHeight * deviceRatio);
    }

    // Call resize after the engine creates the canvas
    function waitForCanvasAndResize(fn) {
      const observer = new MutationObserver((mutations, obs) => {
        if (document.querySelector('canvas')) {
          obs.disconnect();
          fn();
        }
      });
      observer.observe(document.body, { childList: true, subtree: true });
    }

    // --- Mobile input overlay + forwarding characters as keyboard events ---
    (function() {
      const mobileInput = document.getElementById('mobile-text');
      const container = document.getElementById('canvas-container');

      // When user touches the canvas area, enable and focus the mobile input to bring up keyboard
      function onCanvasTap(ev) {
        // only show on narrow screens (heuristic for phones)
        if (window.innerWidth > 900) return; // desktop skip
        document.body.classList.add('show-mobile-input');
        mobileInput.value = '';
        mobileInput.focus({preventScroll:true});
      }

      // Forward characters typed in the HTML input to the page as KeyboardEvents
      function forwardTextAsKeys(text) {
        // For simplicity, send each character as keydown then keyup.
        for (let i = 0; i < text.length; i++) {
          const ch = text[i];
          // create keydown
          const kd = new KeyboardEvent('keydown', {key: ch, char: ch, bubbles: true});
          window.dispatchEvent(kd);
          // create keypress (older consumers)
          try {
            const kp = new KeyboardEvent('keypress', {key: ch, char: ch, bubbles: true});
            window.dispatchEvent(kp);
          } catch(e){}
          // create keyup
          const ku = new KeyboardEvent('keyup', {key: ch, char: ch, bubbles: true});
          window.dispatchEvent(ku);
        }
      }

      // On input, forward only the new chars (this simple approach sends whole value; fine for typing)
      mobileInput.addEventListener('input', (e) => {
        const v = mobileInput.value || '';
        if (v.length > 0) {
          forwardTextAsKeys(v);
          // clear after sending so next input only contains new keystrokes
          mobileInput.value = '';
        }
      });

      // Hide the mobile input if user taps outside or presses escape
      window.addEventListener('touchstart', (e) => {
        // if user taps outside the input, don't force keyboard forever
        if (!mobileInput.contains(e.target)) {
          // keep keyboard if they tap the canvas again; otherwise hide after short delay
          setTimeout(() => {
            document.body.classList.remove('show-mobile-input');
            try { mobileInput.blur(); } catch(e){}
          }, 2500);
        }
      }, {passive:true});

      // Attach tap handler to container (so tapping the canvas opens the input)
      container.addEventListener('touchstart', onCanvasTap, {passive:true});
      container.addEventListener('click', onCanvasTap);

      // Also do a normal resize when the canvas is created
      waitForCanvasAndResize(() => {
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
      });
    })();

    // If your exported HTML contains engine bootstrap calls (Module/Engine),
    // keep them as they were. The loader will attach the canvas to the DOM and our resize code handles it.
  </script>
</body>
</html>

